/*! on-the-githubs 2014-03-04 */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){function b(){var b=c(this),g=f.settings;return isNaN(b.datetime)||(0==g.cutoff||e(b.datetime)<g.cutoff)&&a(this).text(d(b.datetime)),this}function c(b){if(b=a(b),!b.data("timeago")){b.data("timeago",{datetime:f.datetime(b)});var c=a.trim(b.text());f.settings.localeTitle?b.attr("title",b.data("timeago").datetime.toLocaleString()):!(c.length>0)||f.isTime(b)&&b.attr("title")||b.attr("title",c)}return b.data("timeago")}function d(a){return f.inWords(e(a))}function e(a){return(new Date).getTime()-a.getTime()}a.timeago=function(b){return b instanceof Date?d(b):"string"==typeof b?d(a.timeago.parse(b)):"number"==typeof b?d(new Date(b)):d(a.timeago.datetime(b))};var f=a.timeago;a.extend(a.timeago,{settings:{refreshMillis:6e4,allowFuture:!1,localeTitle:!1,cutoff:0,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",wordSeparator:" ",numbers:[]}},inWords:function(b){function c(c,e){var f=a.isFunction(c)?c(e,b):c,g=d.numbers&&d.numbers[e]||e;return f.replace(/%d/i,g)}var d=this.settings.strings,e=d.prefixAgo,f=d.suffixAgo;this.settings.allowFuture&&0>b&&(e=d.prefixFromNow,f=d.suffixFromNow);var g=Math.abs(b)/1e3,h=g/60,i=h/60,j=i/24,k=j/365,l=45>g&&c(d.seconds,Math.round(g))||90>g&&c(d.minute,1)||45>h&&c(d.minutes,Math.round(h))||90>h&&c(d.hour,1)||24>i&&c(d.hours,Math.round(i))||42>i&&c(d.day,1)||30>j&&c(d.days,Math.round(j))||45>j&&c(d.month,1)||365>j&&c(d.months,Math.round(j/30))||1.5>k&&c(d.year,1)||c(d.years,Math.round(k)),m=d.wordSeparator||"";return void 0===d.wordSeparator&&(m=" "),a.trim([e,l,f].join(m))},parse:function(b){var c=a.trim(b);return c=c.replace(/\.\d+/,""),c=c.replace(/-/,"/").replace(/-/,"/"),c=c.replace(/T/," ").replace(/Z/," UTC"),c=c.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),new Date(c)},datetime:function(b){var c=f.isTime(b)?a(b).attr("datetime"):a(b).attr("title");return f.parse(c)},isTime:function(b){return"time"===a(b).get(0).tagName.toLowerCase()}});var g={init:function(){var c=a.proxy(b,this);c();var d=f.settings;d.refreshMillis>0&&setInterval(c,d.refreshMillis)},update:function(c){a(this).data("timeago",{datetime:f.parse(c)}),b.apply(this)}};a.fn.timeago=function(a,b){var c=a?g[a]:g.init;if(!c)throw new Error("Unknown function name '"+a+"' for timeago");return this.each(function(){c.call(this,b)}),this},document.createElement("abbr"),document.createElement("time")}),function(a){a.fn.onthegithubs=function(b){var c=a.extend({},b||{}),d=function(a){var b=a;return b=b.replace(/\/users\//,"/"),b=b.replace(/\/repos\//,"/"),b=b.replace(/\/api\./,"/"),b=b.replace(/\/commits\//,"/commit/")},e=function(a,b){return a.replace(/\{([^\}]*)\}/g,function(a,c){return b.hasOwnProperty(c)?b[c]:""})},f=function(b){if(!b)throw Error('Please set an event source like "orgs/tus" via data-event-source attr or options');var c=a.Deferred(),d=localStorage.getItem("on-the-githubs-feed-"+b),e=localStorage.getItem("on-the-githubs-date-"+b),f=+new Date/1e3,g="https://api.github.com/"+b+"/events?per_page=20&callback=?";return d=JSON.parse(d),d&&d.data&&e&&180>f-e?(c.resolve(d),c):(a.getJSON(g,function(a){if(a.data.message)throw Error("GitHub says: "+a.data.message+" for url: "+g);a.data=a.data.slice(0,20),localStorage.setItem("on-the-githubs-feed-"+b,JSON.stringify(a)),localStorage.setItem("on-the-githubs-date-"+b,f),c.resolve(a)}),c)};return this.each(function(){var b,g,h=a(this);(g=c["event-source"])?b=g:(g=h.data("event-source"))&&(b=g),f(b).done(function(b){h.html("");var c='<abbr class="timeago" title="{created}">{created}</abbr>';c+='<img src="{gravatarSrc}" class="gravatar" />',c+='<p><a target="_blank" href="{userUrl}" class="author">{username}</a> ',c+="<span>{action}</span>",c+=' <a target="_blank" href="{repoUrl}">{repoName}</a>{branch}{commits}</p>',c+='<div class="clearfix"></div>';for(var f=0;f<b.data.length;f++){var g=b.data[f],i=g.actor.avatar_url,j=g.actor.login,k="",l="",m="",n=!1;switch(g.type){case"IssuesEvent":n="closed"===g.payload.issue.state,k=g.payload.action+" ",k+='issue <a target="_blank" href="'+g.payload.issue.html_url+'">',n&&(k+="<s>"),k+=g.payload.issue.title,n&&(k+="</s>"),k+="</a> on";break;case"CommitCommentEvent":k='commented "'+g.payload.comment.body+'" ',k+='on a commit to <a target="_blank" href="'+g.payload.comment.html_url+'">',k+=g.payload.comment.path+"</a> in";break;case"IssueCommentEvent":n="closed"===g.payload.issue.state,k='commented on <a target="_blank" href="'+g.payload.comment.html_url+'">',n&&(k+="<s>"),k+=g.payload.issue.title,n&&(k+="</s>"),k+="</a> in";break;case"PushEvent":if(!g.payload||!g.payload.commits||0===g.payload.commits.length)break;var o=g.payload.commits[0].sha,p=d(g.payload.commits[0].url),q="",r=[],s="";for(var t in g.payload.commits)q=g.payload.commits[t].sha,s=g.payload.commits[t].message.substr(0,50),s.length>g.payload.commits[t].message.length&&(s+=" ..."),r.push(s);var u=p.replace("commit","compare").replace(o,o+"..."+q),v=r.join(" &mdash; ");k="pushed ",1===g.payload.commits.length?(k+='<a target="_blank" rel="tooltip" data-placement="right" title="'+v+'" href="'+p+'">',k+="1 commit",k+="</a>"):(k+='<a target="_blank" rel="tooltip" data-placement="right" title="'+v+'" href="'+u+'">',k+=g.payload.commits.length+" "+"commits",k+="</a>"),k+=" to";break;case"ForkEvent":k="forked";break;case"WatchEvent":k="is now watching";break;case"PullRequestEvent":k=g.payload.action+" ",k+='pull request <a target="_blank" href="'+g.payload.pull_request.html_url+'">',k+=g.payload.pull_request.title,k+="</a> for";break;case"CreateEvent":k="created a new "+g.payload.ref_type+" in",l=': <a target="_blank" href="https://github.com/'+g.repo.name+"/tree/"+g.payload.ref+'">'+g.payload.ref+"</a>";break;default:console.log(g.type,g)}var w=e(c,{gravatarSrc:i,userUrl:d(g.actor.url),username:j,repoUrl:d(g.repo.url),repoName:g.repo.name,branch:l,created:g.created_at,action:k,commits:m});a("<li/>").append(w).appendTo(h)}"timeago"in a("abbr.timeago")&&a("abbr.timeago").timeago(),"tooltip"in a("a[rel]")&&a("a[rel]").tooltip()})})}}(jQuery);