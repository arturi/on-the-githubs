#!/usr/bin/env node
var onTheGithubs = require('..');
var cli          = require('cli').enable('status', 'help', 'version', 'timeout');

cli.parse({
  repo: ['r', 'Repository', 'string'],
  owner: ['o', 'Organisation / User', 'string']
});

cli.main(function(args, options) {
  if (!options.repo) {
    this.fatal('Please specify a repository. Use -h for help. ');
  }
  if (!options.owner) {
    this.fatal('Please specify a organisation. Use -h for help. ');
  }

  var config = {
    service: 'https://api.github.com',
    paginate: true,
    concurrency: 6,
    squash: true,
    userpaths: {
      contributors: [
        // '/orgs/{owner}/members',
        '/repos/{owner}/{repo}/contributors',
        '/repos/{owner}/{repo}/collaborators'
      ],
      collaborators: [
        // '/repos/{owner}/{repo}/issues/comments',
        // '/repos/{owner}/{repo}/issues'
      ],
      watchers: [
        // '/repos/{owner}/{repo}/subscribers',
        // '/repos/{owner}/{repo}/stargazers'
      ]
    }
  };

  config.owner = options.owner;
  config.repo  = options.repo;

  var agg = onTheGithubs.aggregate(cli, config);
  agg.execute(function (err, users) {
    if (err) {
      return cli.error(err);
    }

    // Display users
    for (var type in users) {
      cli.ok(type);
      for (var i in users[type]) {
        cli.ok('  ' + users[type][i].login);
      }
    }
    cli.ok('Done.');
  });
});
