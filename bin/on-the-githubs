#!/usr/bin/env node
var onTheGithubs = require('..');
var cli          = require('cli').enable('status', 'help', 'version', 'timeout');

cli.parse({
  rep: ['r', 'Repository', 'string'],
  org: ['o', 'Organisation', 'string']
});

cli.main(function(args, options) {
  if (!options.rep) {
    this.fatal('Please specify a repository. Use -h for help. ');
  }
  if (!options.org) {
    this.fatal('Please specify a organisation. Use -h for help. ');
  }

  var config = {
    contributors: [
      // '/orgs/{owner}/members',
      '/repos/{owner}/{repo}/collaborators',
      '/repos/{owner}/{repo}/contributors'
    ],
    collaborators: [
      '/repos/{owner}/{repo}/issues/comments',
      '/repos/{owner}/{repo}/issues'
    ],
    watchers: [
      '/repos/{owner}/{repo}/subscribers',
      '/repos/{owner}/{repo}/stargazers'
    ]
  };

  onTheGithubs.aggregate(config, function (err, users) {
    if (err) {
      return cli.error(err);
    }

    for (var type in users) {
      cli.ok(type);
      for (var i in users[type]) {
        cli.ok('  ' + users[type][i].login);
      }
    }
  });
});
